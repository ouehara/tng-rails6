# Terraformによるステージング環境構築手順

本ドキュメントは以下のセクションに分割されています：

## 📁 ドキュメント構成

- **[01-Terraform基盤構築.md](01-Terraform基盤構築.md)** - Terraform基本設定（bootstrap、common、GitHub Actions）
- **[02-環境構築.md](02-環境構築.md)** - ステージング環境構築（dev環境デプロイ、デバッグリソース）
- **[03-データ移行.md](03-データ移行.md)** - S3データ移行（画像・ファイル移行手順）
- **[07-DB復旧.md](07-DB復旧.md)** - データベース移行（PostgreSQL復元手順）
- **[04-ECRイメージコピー.md](04-ECRイメージコピー.md)** - ECRイメージコピー（オプション）
- **[05-SSM運用操作.md](05-SSM運用操作.md)** - SSM踏み台サーバー運用（RDS/ALB内部アクセス）
- **[06-運用操作.md](06-運用操作.md)** - 運用手順（ECS操作、監視、緊急時対応）
- **[99-リソース削除手順.md](99-リソース削除手順.md)** - 削除手順（段階的削除コマンド）


## 📋 作業チェックリスト

- [ ] bootstrap環境の構築
- [ ] common環境の構築
- [ ] ステージング環境の構築
- [ ] ACM証明書のDNS検証
- [ ] S3データ移行
- [ ] データベース移行
- [ ] ECRイメージコピー（オプション）
- [ ] アプリケーション動作確認
- [ ] GitHub Actions設定（任意）

## ⚠️ 重要な注意事項

- **リソース分離**: debug/配下のリソースは一時的なものです。作業完了後は削除してください。
- **証明書設定**: CloudFrontは初回デフォルト証明書で作成し、DNS設定後にカスタムドメインに切り替えます。
- **コスト管理**: データベース移行作業で約190円の追加コストが発生します（S3移行は無料）。
- **バックアップ**: 重要な操作前には必ずバックアップを取得してください。

## 🆘 トラブルシューティング

問題が発生した場合は、以下の順序で確認してください：

1. **Terraform**: `terraform plan` でリソース状態を確認
2. **AWS コンソール**: 該当リソースの状態を直接確認
3. **ログ**: CloudWatch Logs でアプリケーションログを確認
4. **SSM接続**: 内部調査が必要な場合は [05-SSM運用操作.md](05-SSM運用操作.md) を参照
5. **削除**: 問題解決困難な場合は [99-リソース削除手順.md](99-リソース削除手順.md) を参照

---

各詳細手順については、上記の個別ドキュメントを参照してください。
